!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("infestines"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","infestines","partial.lenses"],n):n((e.atom=e.atom||{},e.atom.undo={}),e.I,e.L)}(this,function(e,n,t){"use strict";var u=function(e,t){return t.map(e).skipDuplicates(n.acyclicEqualsU)},i=function(e,n){return{time:e,index:0,values:n}},r=function(e){return i(Date.now(),[e])},o=function(e){return e.values.length-e.index-1},a=function(e){return e.index},c={never:function(){return!1},youngerThan:function(e){return function(n){return n.time-n.old.time<e}}};e.Replace=c,e.default=function(e){function f(e,t){var i=function(){return v.modify(function(u){return t(u)?n.assocPartialU("index",u.index+e,u):u})};return i.count=u(t,v),i.has=u(function(e){return!!e},i.count),i}var s=e.replace,l=void 0===s?c.never:s,d=e.value,v=(0,e.Atom)(r(d)),p=v.view(t.lens(function(e){return e.values[e.index]},function(e,t){if(n.acyclicEqualsU(e,t.values[t.index]))return t;var u=Date.now();return i(u,[e].concat(t.values.slice(o(t)&&l({time:u,value:e,old:t})?t.index+1:t.index)))}));return p.undo=f(1,o),p.redo=f(-1,a),p.initial=u(function(e){var n=e.values;return n[n.length-1]},v),p.reset=function(e){return v.set(r(e))},p},Object.defineProperty(e,"__esModule",{value:!0})});
