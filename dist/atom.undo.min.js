!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("infestines"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","infestines","partial.lenses"],n):n((e.atom=e.atom||{},e.atom.undo={}),e.I,e.L)}(this,function(e,n,t){"use strict";var r=function(e,t){return t.map(e).skipDuplicates(n.acyclicEqualsU)},u=function(e,n){return{time:e,index:0,values:n}},i=function(e){return u(Date.now(),[e])},o=function(e){return e.values.length-e.index-1},a=function(e){return e.index},c=function(e){var n=e.values;return n[n.length-1]},f={never:function(){return!1},youngerThan:function(e){return function(n){return n.time-n.old.time<e}}};e.Replace=f,e.default=function(e){function s(e,t){var u=function(){return p.modify(function(r){return t(r)?n.assocPartialU("index",r.index+e,r):r})};return u.count=r(t,p),u.has=r(function(e){return!!e},u.count),u}var l=e.replace,d=void 0===l?f.never:l,v=e.value,p=(0,e.Atom)(i(v)),m=p.view(t.lens(function(e){return e.values[e.index]},function(e,t){if(n.acyclicEqualsU(e,t.values[t.index]))return t;var r=Date.now();return u(r,[e].concat(t.values.slice(o(t)&&d({time:r,value:e,old:t})?t.index+1:t.index)))}));return m.undo=s(1,o),m.redo=s(-1,a),m.initial=r(c,p),m.reset=function(e){return p.set(i(e))},m.revert=function(){return m.reset(c(p.get()))},m},Object.defineProperty(e,"__esModule",{value:!0})});
